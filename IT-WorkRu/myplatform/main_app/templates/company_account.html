<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <title>IT-WorkRu - интеллектуальная платформа для поиска вакансий и образовательных ресурсов</title>
    {% load static %}
    <link rel="icon" href="{% static 'favicon.ico' %}" type="image/png">
    <style>

        html, body {
            scroll-behavior: smooth;
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Убираем горизонтальную прокрутку */
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        header {
            background-color: #fff;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            width: 100%; /* Растягиваем шапку на всю ширину */
            box-sizing: border-box;
        }
        header a {
            text-decoration: none;
            color: #000;
            margin-right: 35px;
            font-weight: bold;
        }
        header a:hover {
            color: #0056b3;
        }
        .login-btn {
            font-weight: bold;
            background-color: #0056b3;
            color: #fff;
            padding: 10px 23px;
            border-radius: 12px;
            text-decoration: none;
        }
        .login-btn:hover {
            background-color: #003f8c;
            color: white;
        }
        .main-content {
            position: relative;
            text-align: center;
            min-height: 100vh; /* Обеспечивает, что main-content занимает минимум 100% высоты экрана */
            padding: 20px;
        }
          .main_content {

    min-height: 100vh; /* Обеспечивает, что main-content занимает минимум 100% высоты экрана */
   max-width:  1220px;
            width: 100%;
            margin: 0 auto;
            padding: 10px;
        }
        .main-content h1 {
            font-size: 32px;
            color: #333;
        }
        .main-content p {
            font-size: 18px;
            color: #333;
        }
        .search-box {
            margin-top: 45px;
            display: flex;
            align-items: center;
            border: 2px solid #DCDCDC; /* Граница для всего блока */
            border-radius: 5px; /* Скругление углов всего блока */

        }

        .search-box input[type="text"] {
            padding-top: 17.5px; padding-bottom: 17.5px; padding-left: 23px;
            width: 400px; /* Увеличение ширины */
            font-size: 16px;
            border: none; /* Убираем границу у input */
            flex-grow: 1; /* Дает input занимать доступное пространство */
        }

        .search-box button {
            padding: 19px 20px;
            background-color: #0056b3;
            color: white;
            border: none;
            cursor: pointer;
        }

        .search-box button:hover {
            background-color: #003f8c;
        }
        .search-box input[type="text"]:focus {
        outline: none; /* Добавляем свою рамку при фокусе */
        }
        footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            text-align: center;
            padding: 20px;
            background-color: #333;
            font-size: 14px;
            color: #f0f0f0;
        }
/* Для контейнера выпадающего списка */
.dropdown {
    position: relative;
    display: inline-block;
}

/* Скрытый контент выпадающего списка */
.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 250px;
    box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
    z-index: 1;
    top: 240%; /* Используем позиционирование для отображения списка */
    text-align: left;
}

/* Псевдоэлемент для создания буферной зоны */
.dropdown::after {
    content: '';
    display: block;
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    height: 46px; /* Высота буферной зоны */
    background: transparent;
    z-index: 0;
}

/* Показываем выпадающий список при наведении */
.dropdown:hover .dropdown-content {
    display: block;
}

/* Оформление ссылок внутри выпадающего списка */
.dropdown-content a {
    display: block;
    padding: 12px 16px; /* Добавляем отступы внутри элементов */
    width: 100%; /* Ссылка занимает всю ширину */
    box-sizing: border-box; /* Включаем отступы и границы в размеры элемента */
    color: black;
    text-decoration: none;
}

/* При наведении на ссылку изменяется цвет фона по всей ширине */
.dropdown-content a:hover {
    background-color: #f0f0f0; /* Более светлый цвет фона */
    border: none; /* Убираем границы */
    color: #0056b3; /* Изменяем цвет текста */
}

/* Стили для изображений в левом верхнем и правом нижнем углах */
.main-content img:first-of-type {
    position: absolute;
    top: -20px;
    left: 0px;
    width: 280px; /* Настройте размер изображения по необходимости */
    height: auto;
}
.main-content img:last-of-type {
    position: absolute;
    bottom: 140px;
    right: 0px;
    width: 550px; /* Настройте размер изображения по необходимости */
    height: auto;
}

 :root {
  --c-black: #000000;
  --c-dark: #202020;
  --c-white: #ffffff;
  --c-light: #eeeeee;
  --c-gray: #bbbbbb;
  --c-cyan: #afc4e4;
  --c-blue: #1D55A6;
  --c-red: #f66766;

  --fz-s: 14px;
  --fz-m: 16px;
  --fz-l: 18px;
  --fz-xl: 24px;
  --fz-xxl: 36px;
}

.btn {
  font-size: var(--fz-m);
  font-weight: 700;
  background-color: var(--c-blue);
  color: var(--c-white);
  border-radius: 0.5rem;
  border: 1px solid var(--c-blue);
  cursor: pointer;
  transition: all 0.3s ease 0s;
  text-align: center;
}
.btn:hover {
  background-color: var(--c-white);
  color: var(--c-blue);
}
.btn_w {
  font-size: var(--fz-m);
  font-weight: 700;
  background-color: var(--c-blue);
  color: var(--c-white);
  border-radius: 0.5rem;
  border: 1px solid var(--c-blue);
  cursor: pointer;
  transition: all 0.3s ease 0s;
  text-align: center;
}
.btn_w:hover {
  background-color: var(--c-white);
  color: var(--c-blue);
}
.form__title {
  font-size: var(--fz-xxl);
  font-weight: 700;
  margin: 45px 0 30px;
}
.form__main {
  width: 100%;
  display: flex;
  justify-content: space-between;
  grid-gap: 3%;
  margin-bottom: 70px;
}
.form__aside {
  width: 25%;
}
.form__content {
  width: 75;
}

.form__img-box {
  width: 100%;
  height: 35%;
  aspect-ratio: 3/4;

  border-radius: 1rem / 1rem;
  overflow: hidden;
  margin-bottom: 0.5rem;
}
.form__img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center center;
}

.form__person-img__box {
  aspect-ratio: 4/1;
  margin-top: 10px;
}

.form__img-text {
  font-size: var(--fz-s);
  font-weight: 600;
  margin-bottom: 25px;
}
.form__button-title {
  width: 100%;
  padding: 15px;
  margin-bottom: 25px;
}
.form__subtitle {
  font-size: var(--fz-xl);
  font-weight: 700;
  margin-bottom: 20px;
}
.form__status {
}
.form__status-label {
  display: block;
  font-size: var(--fz-m);
  font-weight: 700;
  margin-bottom: 20px;
}
.form__status-input {
}
.form__status-text {
  font-size: var(--fz-s);
  color: var(--c-gray);
  margin-top: 5px;
}

.form__person {
}
.form__content-title {
  margin-top: 45px;
}
.form__content-title:first-child {
  margin-top: 0px;
}
.form__person-label {
  display: block;
  margin-bottom: 15px;
}
.form__person-span {
  display: block;
  font-size: var(--fz-m);
  font-weight: 700;
  margin-bottom: 5px;
}

.form__person-label:has(.form__person-input:required) .form__person-span::after,
.required::after {
  content: " *";
  font-size: 1.3em;
  color: var(--c-red);
  margin-bottom: 15px;
}

.form__person-input {
  width: 100%;
  padding: 10px;
  font-size: var(--fz-m);
  border: 1px solid var(--c-gray);
  border-radius: 0.5rem;
  background-color: #fff;
}

.form__person-radio__box {
  display: flex;
  grid-gap: 45px;
}
.form__person-label__radio {
  display: block;
  font-weight: 500;
}
.form__person-radio,
.form__person-checkbox {
  margin-right: 3px;
}

.form__person-label__checkbox {
  font-weight: 700;
}

.form__password-button {
  margin-bottom: 15px;
  padding: 10px 30px;
}
.form__link-delete {
  display: block;
  color: var(--c-gray);
  text-decoration: underline;
  margin-bottom: 40px;
}

.form__button {
  font-size: var(--fz-l);
  width: 100%;
  padding: 20px;
}

.form__aside-container {
  border: 1px solid var(--c-gray);
  border-radius: 1rem / 1rem;
  padding: 25px 0;
}

.form__aside-title {
  font-size: var(--fz-xl);
  font-weight: 700;
  margin-bottom: 15px;
  padding-left: 20px;
}

.form__aside-list {
}

.form__aside-item {
  padding: 7px 20px;
  transition: all 0.3s ease-in-out;
}

.form__aside-item:hover {
  background-color: var(--c-light);
}

.form__aside-link {
}

.form__resume-box {
  display: flex;
  justify-content: space-between;
  gap: 30px;
  margin-bottom: 10px;
}

.form__person-radio__box-col .form__person-label__radio {
  margin-bottom: 10px;
}

.form__person-radio__box-col .form__person-label__radio:last-child {
  margin-bottom: 0;
}

.form__button-content {
  margin-bottom: 20px;
  padding: 15px;
}

.form__person-box {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.form__person-box .form__status-input {
  margin-right: 10px;
}

.form__person-box .form__status-label {
  font-size: var(--fz-s);
  margin-bottom: 0;
  display: flex;
  align-items: center;
}

.form__person-input__file {
  display: none;
}

.form__person-input__file-label {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 5px 10px;
}

.form__person-input__file-img {
  height: 27px;
  aspect-ratio: 1/2;
}

.form__person-plus__box {
  position: relative;
}

.form__person-plus {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  background-color: var(--c-blue);
  height: 100%;
  aspect-ratio: 1/1;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5em;
  color: var(--c-white);
  border-radius: 0.5rem;
}

.form__person-span_mb {
  margin-bottom: 15px;
}

.form__person-mtb {
  margin: 30px 0;
}

 /* account.component.html */

.account__title {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 20px;
  margin: 40px 0 30px;
}

.account__title-subtitle {
  margin-right: auto;
  font-size: var(--fz-xxl);
  font-weight: 700;
}

.account__title-text {
  font-size: var(--fz-xl);
  font-weight: 700;
}

.account__title-button {
  font-size: var(--fz-l);
  padding: 10px 30px;
}

.account__main {
  width: 100%;
  display: flex;
  justify-content: space-between;
  grid-gap: 3%;
  margin-bottom: 70px;
}

.account__aside {
  width: 20%;
}
.account__content {
  width: 80%;
}

.account__name {
  font-size: var(--fz-l);
  font-weight: 700;
  text-align: center;
  margin: 10px 0;
}
.account__favourites {
  display: flex;
  justify-content: space-between;
  font-size: var(--fz-s);
  margin-bottom: 20px;
}
.account__favourites-link {
  color: var(--c-blue);
  font-weight: 700;
}
.account__favourites-count {
  border-radius: 100%;
  background-color: var(--c-light);
  padding: 0 5px;
}
.account__button-edit {
  width: 100%;
  padding: 10px;
  margin-bottom: 20px;
}
.account__border {

  position: relative;
  border: 1px solid var(--c-gray);
  border-radius: 0.5rem;
  padding: 35px;
  overflow: hidden;
}
.account__border-subtitle {
  font-size: var(--fz-xl);
  font-weight: 700;
  margin-bottom: 30px;
}
.account__border-text {
  margin-bottom: 25px;
}
.account__border-link__span {
  display: block;
  margin-bottom: 35px;
}
.account__border-link__span span {
  color: var(--c-blue);
}
.account__border-list {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.account__border-item {
  width: 23%;
}
.account__border-link {
  width: 100%;
  aspect-ratio: 1/1;
}
.account__border-img {
  width: 70%;
  height: 50%;
}

.account__border-title-wrapper {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.account__border-title {
  font-size: var(--fz-xl);
  font-weight: 700;
  margin-bottom: 50px;
}
.account__border-title-wrapper .account__border-title {
  margin-bottom: 0;
}
.account__border-button {
  padding: 10px 20px;
}
.account__border-button_y {
  padding: 10px 20px;
}
.account__border-content {
  width: 100%;
  font-size: var(--fz-xl);
  font-weight: 700;
  color: var(--c-gray);
  text-align: center;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: rgba(0, 0, 0, 0.1);
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}
.account__border-box {
  min-height: 310px;
  margin-bottom: 40px;
}

.vacancies__list {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 43px 25px;
}
.vacancies__item {
}
.vacancies__link {
  display: flex;
  flex-direction: column;
  font-size: var(--fz-l);
}
.vacancies__title {
  color: var(--c-blue);
  font-weight: 700;
}
.vacancies__text {
  color: var(--c-gray);
  padding: 15px 0;
}
.vacancies__price {
  font-weight: 700;
}
.account__container {
  display: flex;
  justify-content: space-between;
  margin-bottom: 100px;
  grid-gap: 5%;
}
.account__box {
  width: 50%;
  min-height: 450px;
}
.link__list {
  margin-bottom: 40px;
}
.link__item {
  margin-bottom: 20px;
}
.link__item:last-child {
  margin-bottom: 0;
}
.link__link {
  font-size: var(--fz-l);
  display: block;
  padding: 10px 30px;
  background-color: var(--c-cyan);
  border-radius: 0.5rem;
}
.link__button {
  width: 50%;
  min-width: 250px;
  text-align: center;
  padding: 10px 30px;
  margin: 0 auto;
}
.account__development {
}

.company__time {
  color: var(--c-gray);
  text-align: center;
  font-weight: 700;
  margin-bottom: 15px;
}

.company__box-link {
  margin-bottom: 30px;
}

.company__link {color: black;
  text-decoration: none;
  display: flex;
  align-items: center;
  font-size: var(--fz-s);
  margin-bottom: 10px;
}

.company__link:last-child {
  margin-bottom: 0;
}

.company__link span {
  color: var(--c-blue);
}

.company__link img {
  width: 25px;
  aspect-ratio: 1/1;
  margin-right: 5px;
}

.account__border-box__resume {
  height: 590px;
}

.popup__wrapper {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: var(--c-gray);
  margin-bottom: 100px;
  padding: 30px 0;
}

.popup {
  margin: 0 auto;
  border: 1px solid var(--c-gray);
  padding: 40px 60px;
  border-radius: 0.5rem;
  background-color: var(--c-light);
}

.popup button {
  display: block;
  margin: 0 auto;
}

.container {max-width: 1200px;
width: 100%;
margin: 0 auto;

display: flex;
align-items: center;
justify-content: space-between;
}
    </style>
</head>
<body>

<header style="border-bottom: 4px solid #0056b3; display: flex; align-items: center; justify-content: space-between; padding: 10px 20px;">
    <div class="container">
    <div>
        <style>  .no-select {
        user-select: none; /* Запрет выделения текста */
        -webkit-user-select: none; /* Для WebKit-браузеров */
        -moz-user-select: none; /* Для Firefox */
        -ms-user-select: none; /* Для старых IE */
    } </style>
        <a class="no-select" href="../" style="font-family: Arial, sans-serif; font-size: 24px; font-weight: 800; color: #0056b3; text-decoration: none;">
            IT-Work<span style="color: #FD494C;">Ru</span>
        </a>
    </div>
        {% if not user.is_authenticated %}
    <div style="display: flex; gap: 20px; align-items: center;">

        <div class="dropdown">
            <a href="#" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Работодателям</a>
            <div class="dropdown-content">
                <a href="../finder">Найти сотрудника</a>
                <a href="../page_vacancy">Разместить вакансию</a>
                <a href="../register_employer">Зарегистрироваться</a>
            </div>
        </div>
        <div class="dropdown">
            <a href="#" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Соискателям</a>
            <div class="dropdown-content">
                <a href="../finder">Найти работу</a>
                <a href="../page_resume">Создать резюме</a>
                <a href="../register_applicant">Зарегистрироваться</a>
            </div>
        </div>
        <div class="dropdown">
            <a href="../blog" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Блог</a>
        </div>
        {% else %}

        {% if user.role == "applicant" %}
 <div style="display: flex; gap: 20px; align-items: right;">
                <div class="dropdown">
            <a href="../finder" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Найти работу</a>
        </div>
                <div class="dropdown">
            <a href="../blog" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Блог</a>
        </div>
                <div class="dropdown">
            <a href="../page_resume" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Создать резюме</a>
        </div>

     </div>
        {% else %}

 <div style="display: flex; gap: 20px; align-items: right;">
                <div class="dropdown">
            <a href="../finder" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Найти сотрудника</a>
        </div>
        <div class="dropdown">
            <a href="../blog" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Блог</a>
        </div>
                <div class="dropdown">
            <a href="../page_vacancy" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Разместить вакансию</a>
        </div>

</div>





        {% endif %}


         {% endif %}
        {% if user.is_authenticated %}
        <div class="dropdown" id="dropdown-important" style="display: flex; flex-direction: row;">

        <img style="width: 38px; border-radius: 50%;" src="{% static 'profile.png' %}" alt="profile">
        <div style="margin-left: 15px; text-align: left;">


            <span style="color: #2A3137; font-size: 18px; font-family: Arial; font-weight: 700; word-wrap: break-word; display: block;">
                {{ user.first_name }} {{ user.last_name }}
            </span>
            <span style="color: #A1A1A1; font-size: 16px; font-family: Arial; font-weight: 400; word-wrap: break-word; display: block;">
                {{ user.email }}
            </span>


        </div>

        <img class="rotating-image_1"
     style="cursor: pointer; margin-top: 10px; margin-left: 16px; width: 13px; height: 20px; transform: rotate(-180deg); transition: transform 0.3s ease;"
     src="{% static 'Down.png' %}"
     alt="Down" />
                   <div class="dropdown-content" style="margin-top: -40px; min-width: 300px; top: 240%;">
                        {% if user.role == "applicant" %}
                        <a href="../featured_jobs" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;"><img style="width: 23px; border-radius: 80%; margin-left: -3px; margin-bottom: -4px; padding-right: 7px;" src="{% static 'love_vacancies.png' %}" alt="love_vacancies">Избранные вакансии (0)</a>
                        <a href="../person_notifications" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Уведомления (0)</a>
                        <a href="../person_account#my_resumes" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Мои резюме (0)</a>
                       <a href="../person_account" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Личный кабинет</a>
                       <a href="../person_account/#employers_responses" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Отклики работодателей (0)</a>
                        <a href="../page_person" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Редактировать данные</a>
                       <a href="../page_person/#change_password_applicant" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Изменить пароль</a>
                       <a href="../person_account/#current_balance_applicant" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Текущий баланс: 0 руб.</a>
                       <a href="../payment_person_history" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">История платежей</a>
                       <a href="../person_account?action=openPopup_person" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Пополнить баланс</a>
                       {% else %}
                        <a href="../company_notifications" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Уведомления (0)</a>
                        <a href="../company_account#my_vacancies" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Вакансии компании (0)</a>
                        <a href="../company_account" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Личный кабинет</a>
                       <a href="../company_account#applicants_responses" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Отклики соискателей (0)</a>
                        <a href="../page_company" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Редактировать данные</a>
                       <a href="../page_company#change_password_employer" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Изменить пароль</a>
                       <a href="../company_account#current_balance_employer" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Текущий баланс: 0 руб.</a>
                       <a href="../payment_company_history" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">История платежей</a>
                       <a href="../company_account?action=openPopup_company" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Пополнить баланс</a>
                       {% endif %}
<a href="#" onclick="logout()" style="display: flex; align-items: center;">
    <img style="width: 23px; border-radius: 80%;  margin-left: -3px; margin-top: -2px; padding-right: 7px;" src="{% static 'exit_image_1.png' %}" alt="exit_image">
    <span style=" font-family: Arial, sans-serif; font-size: 16px;">Выйти</span>
</a>


            </div>

        </div>
        {% else %}
        <a href="../login" class="login-btn" style="font-family: Arial, sans-serif; font-size: 16px; text-decoration: none;">Войти</a>
        {% endif %}




    </div></div>
</header>
<script>
// Получаем контейнер по ID
const dropdownContainer = document.getElementById('dropdown-important');

// Получаем стрелку
const rotatingImage = dropdownContainer.querySelector('.rotating-image_1');

// Добавляем обработчики событий на весь контейнер
dropdownContainer.addEventListener('mouseover', () => {
    rotatingImage.style.transform = 'rotate(0deg)'; // Поворачиваем стрелку вверх
});

dropdownContainer.addEventListener('mouseout', () => {
    rotatingImage.style.transform = 'rotate(-180deg)'; // Возвращаем стрелку вниз
});



    function logout() {
        fetch('{% url "logout" %}', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            },
            credentials: 'same-origin'
        })
        .then(response => {
            if (response.ok) {
                // Если выход успешен, обновите интерфейс или перезагрузите страницу
                location.reload();  // Перезагрузка страницы
            }
        })
        .catch(error => console.error('Ошибка при выходе:', error));
    }
</script>
<script>    let lastClickedInterviewButton = null;</script>
<div class="main_content">
<div class="account__title">
  <h1 class="account__title-subtitle" id="current_balance_employer">Компания ООО “ИИ Business Tech”</h1>
  <h2 class="account__title-text">Текущий баланс: 0 руб.</h2>
  <button class="btn account__title-button" id="balance_btn" type="submit">
    Пополнить баланс
  </button>
</div>

<div class="account__main">
  <aside class="account__aside">
    <div class="form__img-box">
                      {% if user.profile_image %}
        <img class="form__img" src="{{ user.profile_image.url }}" alt="organization" />
      {% else %}
        <img class="form__img" src="{% static 'organization.png' %}" alt="organization" />
      {% endif %}
    </div>
    <div class="company__time">На сайте: 1 год 5 месяцев</div>
    <div class="company__box-link">
      <a class="company__link" href="#">
        <img src="{% static 'email.png' %}" alt="" />
        Почта:&nbsp;<span>email@example.com</span>
      </a>
      <a class="company__link" href="#">
        <img src="{% static 'tel.png' %}" alt="" />
        Телефон:&nbsp;<span>+7 (XXX) XXX-XX-XX</span>
      </a>
    </div>
      <a href="../page_company"><button class="account__button-edit btn">Редактировать данные</button></a>
    <div class="account__border">
      <h3 class="account__border-subtitle">Контакты для работодателей:</h3>
      <p class="account__border-text" >
       <span style="color: black;
  text-decoration: none;" > Специалисты <br>IT-WorkRu всегда готовы ответить на ваши вопросы.</span>
      </p>
      <a class="account__border-link__span" style="color: black;
  text-decoration: none;" href="">
        Задайте их, отправив
        <span>контактную форму</span>
        или напишите нам:
      </a>
      <ul class="account__border-list" style="margin-left: -40px;">
        <div class="account__border-item">
          <a class="account__border-link" href="#">
            <img class="account__border-img" src="{% static 'tg.png' %}" alt="" />
          </a>
        </div>
        <div class="account__border-item">
          <a class="account__border-link" href="#">
            <img class="account__border-img" src="{% static 'vk.png' %}" alt="" />
          </a>
        </div>
        <div class="account__border-item">
          <a class="account__border-link" href="#">
            <img class="account__border-img" src="{% static 'wp.png' %}" alt="" />
          </a>
        </div>
      </ul>
    </div>
  </aside>

  <div class="account__content">

    <div class="account__border account__border-box" id="my_vacancies">
      <div class="account__border-title-wrapper" >
        <h3 class="account__border-title">Вакансии компании:</h3>
        <a href="../page_vacancy"><button class="account__border-button btn_new" style="cursor: pointer; position: relative; z-index: 0;">Создать вакансию</button></a>
      </div>

<style>
/* Контейнер с прокруткой */
.vacancy-scroll-container {
  max-height: 812px;
  overflow-y: auto;
  padding-right: 10px;
}

/* Стилизация скроллбара для Webkit (Chrome, Safari, Edge) */
.vacancy-scroll-container::-webkit-scrollbar {
  width: 6px;
}

.vacancy-scroll-container::-webkit-scrollbar-track {
  background: transparent;
}

.vacancy-scroll-container::-webkit-scrollbar-thumb {
  background-color: rgba(0, 0, 0, 0.2);
  border-radius: 10px;
  transition: background-color 0.3s;
}

.vacancy-scroll-container::-webkit-scrollbar-thumb:hover {
  background-color: rgba(0, 0, 0, 0.4);
}

/* Для Firefox */
.vacancy-scroll-container {
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
}

.vacancy-list {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.vacancy-card {
  border: 1px solid #ddd;
  border-radius: 10px;
  padding: 20px;
  background-color: #fff;
  display: flex;
  justify-content: space-between;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.vacancy-info {
  max-width: 80%;
}

.vacancy-title {
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 5px;
}

.vacancy-city {
  color: #888;
  margin-bottom: 10px;
}

.vacancy-description {
  color: #333;
}

.vacancy-salary {
  font-weight: bold;
  color: #333;
  white-space: nowrap;
}

.btn_2 {
  font-size: var(--fz-m);
  font-weight: 700;
  background-color: #007bff;
  color: var(--c-white);
  border-radius: 0.5rem;
  border: 1px solid #007bff;
  cursor: pointer;
  transition: all 0.3s ease 0s;
  text-align: center;
}
.btn_2:hover {
  background-color: var(--c-white);
  color: #007bff;
}

    .btn_new {
  font-size: var(--fz-m);
  font-weight: 700;
  background-color: var(--c-blue);
  color: var(--c-white);
  border-radius: 0.5rem;
  border: 1px solid #007bff;
  cursor: pointer;
  transition: all 0.3s ease 0s;
  text-align: center;
}
.btn_new:hover {
  background-color: var(--c-white);
  color: var(--c-blue);
}
</style>

        <!-- Добавляем стили и скрипты Cropper.js -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>

<div class="vacancy-scroll-container" style="margin-top: 20px;">
  <div class="vacancy-list">
    {% if vacancies %}
      {% for vacancy in vacancies %}
        <div class="vacancy-card">
          <div class="vacancy-info">
            <div class="vacancy-title">{{ vacancy.title }}</div>

            <div class="vacancy-city">{{ vacancy.employer.company_name }} | {{ vacancy.city_1 }}</div>
<p  style="margin-top: 20px;">{{ vacancy.created_at|date:"j E Y" }}</p>



          </div>
<div class="vacancy-salary" style="display: flex; flex-direction: column; align-items: flex-end; text-align: right;">
  <div>
       {% if vacancy.salary_from_1 %}
      от {{ vacancy.salary_from_1 }}
    {% endif %}

    {% if vacancy.salary_to_1 %}
      до {{ vacancy.salary_to_1 }}
    {% endif %}

  {% if vacancy.currency_1 == "RUB" %}
    руб.
  {% elif vacancy.currency_1 == "USD" %}
    $
  {% elif vacancy.currency_1 == "EUR" %}
    €
  {% elif vacancy.currency_1 == "CNY" %}
    ¥
  {% else %}
    {{ vacancy.currency_1 }}
  {% endif %}
    <br><br>   <div style="display: flex; justify-content: flex-end; width: 100%;">
    <button class="account__border-button btn_2" style="cursor: pointer; margin-top: 20px;">Подробнее</button>
  </div></div>
    <!--<button class="account__border-button btn_2" style="cursor: pointer;">Создать интервью</button>-->
</div>


        </div>
      {% endfor %}
    {% else %}
      <p>У компании пока нет вакансий.</p>
    {% endif %}
  </div>
</div>



    </div>



  </div>

</div>

    <div id="generation-warning" style="display: none; margin-bottom: 50px;">
  <div class="warning-content">
    <div class="warning-text">
      <b>Пожалуйста, не покидайте страницу личного кабинета до окончания генерации всех интервью,<br>
      иначе приглашения на интервью соискателям не будут отправлены.</b>
    </div>
    <div class="spinner"></div>
  </div>

  <!-- Прогресс-бар -->
  <div id="progress-bar-container" style="width: 100%; background-color: #f3f3f3; height: 20px; border-radius: 10px; margin-top: 10px;">
    <div id="progress-bar" style="width: 0%; height: 100%; background-color: #007bff; border-radius: 10px;"></div>
  </div>
  <div id="progress-text" style="text-align: center; margin-top: 5px;"></div>
</div>

        <div class="account__border account__border-box__resume" style="max-height: 780px; margin-bottom: 72px; margin-top: -35px;" id="applicants_responses">




<style>
      /* Стили для прогресс-бара */
  #progress-bar-container {
    display: none; /* Скрыто, пока не начинается генерация */
  }
  #progress-bar {
    height: 100%;
    background-color: #007bff;
    border-radius: 10px;
  }
  #progress-text {
    text-align: center;
    margin-top: 5px;
  }

#generation-warning {
  width: 100%;
  background-color: #ffe5e5;
  border: 2px solid #dc3545;
  color: #dc3545;
  font-size: 18px;
  font-weight: bold;
  padding: 20px;
  margin-bottom: 10px;
  border-radius: 10px;
  box-sizing: border-box;
}

.warning-content {
  display: flex;
  align-items: center; /* Выровнять по вертикали */
  justify-content: space-between; /* Текст слева, спиннер справа */
}

.warning-text {
  flex: 1;
  margin-right: 20px;
}

.spinner {
  width: 30px;
  height: 30px;
  border: 4px solid #f3f3f3;
  border-top: 4px solid #dc3545;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#progress-bar {
  width: 0%;
  height: 100%;
  background-color: #007bff;
  border-radius: 10px;
}

    .custom-select-wrapper {
  position: relative;
  font-family: sans-serif;
  width: max-content;
  min-width: 200px;
}

.custom-select-trigger {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  cursor: pointer;
  background-color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: border-color 0.3s ease;
}

.custom-select-trigger:hover {
  border-color: #888;
}

.arrow-icon {
  transition: transform 0.3s ease;
}

.custom-options {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  border: 1px solid #ccc;
  border-top: none;
  background: white;
  z-index: 1000;
  max-height: 200px;
  overflow-y: auto;
  border-radius: 0 0 4px 4px;
}

.custom-option {
  padding: 8px 12px;
  cursor: pointer;
}

.custom-option:hover {
  background-color: #f0f0f0;
}

/* Показываем при наведении */
.custom-select-wrapper:hover .custom-options {
  display: block;
}
</style>





<div style="display: flex; align-items: center; justify-content: space-between;">
  <h3 class="account__border-title">Отклики соискателей:</h3>

  <!-- Кастомный селект -->
  <div class="custom-select-wrapper" style="margin-right: 21px; margin-bottom: 30px;">
    <div class="custom-select-trigger">
      Все вакансии
      <svg class="arrow-icon" viewBox="0 0 24 24" width="12" height="12">
        <path d="M7 10l5 5 5-5z" fill="#333"/>
      </svg>
    </div>
    <div class="custom-options">
      <div class="custom-option" data-value="">Все вакансии</div>
      {% for vacancy in vacancies %}
        <div class="custom-option" data-value="{{ vacancy.id }}">
          {{ vacancy.title }}
        </div>
      {% endfor %}
    </div>
  </div>
</div>



<div class="vacancy-scroll-container" id="vacancy-scroll-container_12" style="max-height: 518px; margin-top: -28px;">
  <div id="vacancy-responses-list" class="vacancy-list">
    {% if responses %}
      {% for response in responses %}
        <div class="vacancy-card">
            <input type="hidden" name="vacancy-id" value="{{ response.vacancy.id }}">
          <div class="vacancy-info">
            <div class="vacancy-title">
              {{ response.applicant.first_name }} {{ response.applicant.last_name }}
            </div>

            <div class="vacancy-city">
              Вакансия: {{ response.vacancy.title }}
            </div>

{% if response.interview.match_percentage is not None %}
  {% with percentage=response.interview.match_percentage %}
    <span style="font-weight: bold;">
      {% if percentage <= 30 %}
        <span style="color: #900020;">✓ Интервью пройдено: {{ percentage }}%</span>
      {% elif percentage <= 60 %}
        <span style="color: #CC5500;">✓ Интервью пройдено: {{ percentage }}%</span>
      {% else %}
        <span style="color: green;">✓ Интервью пройдено: {{ percentage }}%</span>
      {% endif %}
      <button class="account__border-button btn_2 interview-details-btn"
              data-interview-id="{{ response.interview.id }}"
              style="margin-left: 10px; cursor: pointer; font-size: 13px; padding: 6px 10px;">
        Подробнее
      </button>
    </span>
  {% endwith %}
{% endif %}

<!-- Контейнер для изолированной модалки -->
<div id="bootstrap-modal-host"></div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const modalHost = document.getElementById("bootstrap-modal-host");
  const shadow = modalHost.attachShadow({ mode: "open" });

  shadow.innerHTML = `
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <style>

    .modal-dialog {
  max-width: 70%; /* Увеличиваем до 90% ширины экрана */
  margin: 1.75rem auto; /* Оставляем отступы сверху и снизу */
}

      .modal-backdrop {
        z-index: 1040;
      }
      .modal {
  display: none;
  z-index: 1050;
  background-color: rgba(0, 0, 0, 0.5);
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  overflow: auto;
  justify-content: center;
  align-items: center;
}

.modal.show {
  display: flex !important;
}

/* Внутренний контейнер модального окна */
.modal-dialog {
  max-width: 70%;
  max-height: 50%;
  margin: 1.75rem auto;
  margin-bottom: 610px; /* Отступ снизу */
}

      /* Прокручиваемая таблица */
      .table-scrollable {
        max-height: 700px;
        overflow-y: auto;
        overflow-x: hidden;
      }

      /* Контрастная полоса прокрутки */
      .table-scrollable::-webkit-scrollbar {
        width: 10px;
      }
      .table-scrollable::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      .table-scrollable::-webkit-scrollbar-thumb {
        background: #3498db; /* Ярко-голубой цвет для заметности */
        border-radius: 5px;
      }
      .table-scrollable::-webkit-scrollbar-thumb:hover {
        background: #2980b9;
      }

/* Уменьшаем ширину колонок "Вопрос" и "Ответ" */
.table-scrollable td:nth-child(1), .table-scrollable td:nth-child(2) {
  width: 30%; /* Устанавливаем фиксированную ширину */
}

/* Оставляем колонку "Видеоответ" с адаптивной шириной */
.table-scrollable td:nth-child(3) {
  width: auto; /* Колонка видео остаётся автоматической */
}

      /* Шапка таблицы */
      .thead-custom {
        background-color: #007bff;
        color: white;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      /* Видео большего размера */
      .video-container video { display: block;
        width: 150%;
        max-width: 600px;
        height: auto;
        margin-bottom: 10px;

      }

      .video-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
}

    </style>

    <!-- Модальное окно -->
    <div class="modal" id="interviewDetailsModal" role="dialog">
      <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Вопросы и ответы интервью</h5>
            <button type="button" class="close" aria-label="Close" onclick="hideShadowModal()">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
          <div id="interviewSummary" class="mb-3 p-3 bg-light border rounded text-dark" style="font-size: 1rem; display: none;"></div>
            <div class="table-scrollable">
              <table class="table table-bordered table-striped">
                <thead class="thead-custom">
                  <tr>
                    <th>Вопрос</th>
                    <th>Ответ</th>
                    <th>Видеоответ</th>
                  </tr>
                </thead>
                <tbody id="interviewQuestionsTable">
                  <!-- Вопросы будут вставлены сюда через JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;

  window.showShadowModal = function (questions = [], summary = '') {
  const tableBody = shadow.getElementById("interviewQuestionsTable");
  const summaryBlock = shadow.getElementById("interviewSummary");
  tableBody.innerHTML = "";

  if (summary) {
    summaryBlock.innerText = summary.trim();
    summaryBlock.style.display = 'block';
  } else {
    summaryBlock.style.display = 'none';
  }

  if (!Array.isArray(questions)) questions = [];

  if (questions.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="3">Нет данных</td></tr>';
    return;
  }

  const seen = new Set();
  const greetingRow = [];
  const otherRows = [];

  for (const q of questions) {
    const text = q.text?.trim() || '';
    const answer = q.text_answer?.trim() || '';
    const key = `${text}||${answer}`;
    if (seen.has(key)) continue;
    seen.add(key);

    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${text}</td>
      <td>${answer}</td>
      <td class="video-container">
        ${
          q.videos && q.videos.length > 0
            ? q.videos
                .map(
                  (url) => `
              <video controls preload="metadata" style="max-width: 100%; height: auto;">
                <source src="${url}" type="video/webm">
                Ваш браузер не поддерживает воспроизведение видео.
              </video>
            `
                )
                .join('')
            : 'Нет видео'
        }
      </td>
    `;

    if (text.startsWith('Здравствуйте! Я ваш виртуальный HR-ассистент.')) {
      greetingRow.push(row);
    } else {
      otherRows.push(row);
    }
  }

  if (greetingRow.length > 0) tableBody.appendChild(greetingRow[0]);
  otherRows.forEach((row) => tableBody.appendChild(row));

  const modal = shadow.getElementById("interviewDetailsModal");
  modal.classList.add("show");

  const closeOnClickOutside = (e) => {
    if (e.target === modal) {
      hideShadowModal();
      shadow.removeEventListener('click', closeOnClickOutside);
    }
  };
  shadow.addEventListener('click', closeOnClickOutside);
};


  window.hideShadowModal = function () {
    const modal = shadow.getElementById("interviewDetailsModal");
    modal.classList.remove("show");

    // Убираем обработчики событий
    shadow.querySelectorAll('*').forEach(el => el.removeEventListener('click', () => {}));
  };

  // Обработка клика по кнопке "Подробнее"
  $(document).on('click', '.btn_2', function () {
    const interviewId = $(this).data('interview-id');

    $.ajax({
  url: '/interview-details/' + interviewId + '/',
  success: function (data) {
    const questions = data.questions || [];
    const summary = data.summary || '';
    showShadowModal(questions, summary);
  },
  error: function () {

  }
});

  });
});
</script>


            <p style="margin-top: 30px;">
              {{ response.responded_at|date:"j E Y" }}
            </p>

            {% if response.message %}
              <div style="margin-top: 10px;">
                <strong>Сообщение:</strong> {{ response.message }}
              </div>
            {% endif %}
          </div>

          <div class="vacancy-salary" style="display: flex; flex-direction: column; align-items: flex-end; text-align: right;">
            <div>
<div style="display: flex; justify-content: flex-end; width: 100%;">
  <a>
    <button class="account__border-button btn_2" style=" cursor: pointer; font-size: 13px; padding: 6px 10px;">
      Резюме
    </button>
  </a>
</div>

<!-- КНОПКИ -->
<div style="display: flex; justify-content: flex-end; width: 100%; margin-top: 10px;">
                 <button class="account__border-button btn_2 btn-ai" style="cursor: pointer; font-size: 13px; padding: 6px 10px;"      data-applicant-id="{{ response.applicant.id }}"
        data-vacancy-id="{{ response.vacancy.id }}"
        onclick="handleInterviewClick(event, '{{ response.vacancy.title }}', '{{ response.vacancy.skills_hidden}}', '{{ response.vacancy.employer.company_name}}', '{{ response.applicant.first_name}}', '{{ response.applicant.last_name}}', '{{ response.applicant.get_role_display}}')" type="button">
  Интервью с AI
</button> </div>

<script>

  // Функция обработки клика по кнопке "Интервью с AI"
function handleInterviewClick(event, vacancyTitle, vacancySkills, vacancyCompany, applicantName, applicantLastName, applicantRole) {
  // Устанавливаем ссылку на кнопку, по которой кликнули
  lastClickedInterviewButton = event.target;

  // Добавляем данные напрямую в свойство generateData
  if (lastClickedInterviewButton) {
    lastClickedInterviewButton.generateData = {
      vacancyTitle,
      vacancySkills,
      vacancyCompany,
      applicantName,
      applicantLastName,
      applicantRole
    };
  }

  // Выводим данные в консоль (для отладки)
  console.log('Название вакансии:', vacancyTitle, "-", vacancyCompany);
  console.log('Навыки:', vacancySkills);
  console.log('Соискатель:', applicantName, applicantLastName, "(", applicantRole, ")");
}
</script>

<!-- ПОПАП -->
<div class="popup__wrapper_w" id="popupWrapper_person_x">
  <div class="popup">
    <div class="form">
      <h2 class="form__title" style="margin-top: -5px;">
        Создание интервью <br />
        соискателя с HRRU 24
      </h2>
      <form class="form-box" action="">
        <div class="form__list">

<div class="form__item">
  <label for="gender" class="form__person-span">Пол HR-агента</label>
  <div class="custom-select" onclick="toggleArrow(this)">
    <select class="form__select" name="gender" id="gender" onchange="resetArrow(this)">
      <option class="form__option" value="" disabled hidden>Выбрать</option>
      <option class="form__option" value="ЖЕН" selected>Женский</option>
      <option class="form__option" value="МУЖ">Мужской</option>
    </select>
    <span class="arrow">
      <svg width="16" height="16" viewBox="0 0 24 24">
        <path d="M9 18l6-6-6-6" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
      </svg>
    </span>
  </div>
</div>






<div class="form__item">
  <input class="form__input-file" type="file" id="agentInput" accept=".png, .jpg, .jpeg, .webp" onchange="updateFileName()" />
  <label class="form__input-file__label" for="agentInput" id="fileLabel">
    Выберите фотографию HR-агента
  </label>
  <span class="form__span" id="changeImageText" style="display: none;">Или, нажав на выделенную область, выберите другое изображение</span>
  <span class="form__span">Формат .png, .jpg или .webp</span>

  <!-- Здесь будет отображаться обрезанное изображение -->
  <div id="croppedImageContainer"></div>
</div>


<!-- Имя HR-агента -->
          <div class="form__item">
            <label class="form__person-span">Имя HR-агента</label>
            <input class="form__input" type="text" id="agentName" placeholder="Введите имя HR-агента" />
          </div>







        </div>



<!--<div class="form__item">
  <label class="form__person-span">Список приоритетных вопросов (не более 15)</label>

  <div id="editor" style="height: 200px;"></div>
</div>-->



        <!--<button  class="account__border-button_y btn_w">Сгенерировать интервью</button>-->
          <!-- Кнопка ГЕНЕРАЦИИ интервью -->
<br><button
    class="account__border-button_y btn_w"
    id="generate-interview-btn" type="button">
    Сгенерировать интервью
</button>





      </form>
    </div>
  </div>
</div>


<!-- Модальное окно для Cropper.js -->
<div id="cropperModal" class="modal" style="z-index: 999;">
  <div class="modal-content">
    <img id="imageToCrop" src="" alt="Image to crop" />
    <div class="btn-wrapper">
      <button id="closeCropperModal" class="account__border-button close-btn">Выбрать область изображения</button>
        <button id="cancelCropperModal" class="account__border-button close-btn" style="margin-left: 30px;">Отменить</button>
    </div>
  </div>
</div>

<style>
.close-btn {
  font-size: var(--fz-m);
  font-weight: 700;
  background-color: var(--c-blue);
  color: var(--c-white);
  border-radius: 0.5rem;
  border: 1px solid var(--c-blue);
  cursor: pointer;
  transition: all 0.3s ease 0s;
  text-align: center;
  padding: 10px 20px;
}

.close-btn:hover {
  background-color: var(--c-white);
  color: var(--c-blue);
}

/* Центрирование кнопки */
.btn-wrapper {
  display: flex;
  justify-content: center;
  margin-top: 15px;
}

/* Обертка модального окна с прокруткой */
.modal-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  max-height: 80vh; /* Максимальная высота окна */
  overflow-y: auto; /* Вертикальная прокрутка */
  padding: 20px;
}

#imageToCrop {
  max-width: 100%;
  max-height: 70vh; /* Ограничение размера изображения */
  object-fit: contain; /* Сохраняет пропорции изображения */
}
</style>










                <!-- Иконки для принятия или отклонения отклика -->
<div style="margin-top: 10px; display: flex; justify-content: flex-end; gap: 10px;">
  <!-- Принять -->
  <span title="Принять отклик" style="cursor: pointer; font-size: 18px;">✅</span>

  <!-- Отклонить -->
  <span title="Отклонить отклик" style="cursor: pointer; font-size: 18px;">❌</span>
</div>

            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="account__border-responses">
        У вас пока нет откликов на вакансии.
      </div>
    {% endif %}
  </div>
</div>



    </div>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const trigger = document.querySelector('.custom-select-trigger');
  const optionsContainer = document.querySelector('.custom-options');
  const options = document.querySelectorAll('.custom-option');

  // Показываем/скрываем выпадающий список при клике на триггер
  trigger.addEventListener('click', function (e) {
    e.stopPropagation();
    optionsContainer.style.display = optionsContainer.style.display === 'block' ? 'none' : 'block';
  });

  // Закрываем меню при клике вне его
  document.addEventListener('click', function () {
    optionsContainer.style.display = 'none';
  });

  // Обработчик клика по опции
  options.forEach(option => {
    option.addEventListener('click', function (e) {
      e.stopPropagation(); // Не закрываем при клике на пункт

      const selectedId = this.getAttribute('data-value');
      const selectedText = this.textContent.trim();

      // Обновляем триггер
      trigger.innerHTML = `
        ${selectedText}
        <svg class="arrow-icon" viewBox="0 0 24 24" width="12" height="12">
          <path d="M7 10l5 5 5-5z" fill="#333"/>
        </svg>
      `;

      // Фильтруем карточки
      const container = document.getElementById('vacancy-scroll-container_12');
      if (!container) return;

      const cards = container.querySelectorAll('.vacancy-card');

      // СНАЧАЛА ПОКАЗЫВАЕМ ВСЕ КАРТОЧКИ
      cards.forEach(card => {
        card.style.display = '';
      });

      // ТЕПЕРЬ ФИЛЬТРУЕМ
      cards.forEach(card => {
        const cardVacancyId = card.getAttribute('data-vacancy-id');
        if (!selectedId || cardVacancyId === selectedId) {
          card.style.display = ''; // явно показываем
        } else {
          card.style.display = 'none';
        }
      });
    });
  });

  // Добавляем data-vacancy-id к каждой карточке
  const container = document.getElementById('vacancy-scroll-container_12');
  if (container) {
    const cards = container.querySelectorAll('.vacancy-card');
    cards.forEach(card => {
      const input = card.querySelector('input[name="vacancy-id"]');
      if (input) {
        card.setAttribute('data-vacancy-id', input.value);
      }
    });
  }
});
    </script>
<div class="account__container">









          <div class="account__box account__border">
    <h3 class="account__border-title">Рекомендуем специалистов:</h3>
    <div class="account__border-content">Раздел находится в разработке</div>
  </div>
      <div class="account__box account__border">
    <h3 class="account__border-title">Последние поиски специалистов:</h3>
    <div class="account__border-content">Раздел находится в разработке</div>
  </div>




</div>




</div>

<style>
    /* Стили для попапа */
    .popup__wrapper_w {
      display: none; /* Скрываем попап по умолчанию */
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }

    /* Стили для попапа */
    .popup__wrapper {
      display: none; /* Скрываем попап по умолчанию */
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }

  </style>

<div class="popup__wrapper" id="popupWrapper_company">
  <div class="popup">
    <form id="form__person popup__form" class="form__person" action="">
      <label class="form__person-label">
        <span class="form__person-span">Введите сумму для пополнения</span>
        <input  style="width: 91%;"
          class="form__person-input"
          type="number"
          name="sum"
          id="sum"
          placeholder="Сумма"
          required
        />
      </label>
      <button class="form__password-button btn" type="submit">
        Пополнить баланс
      </button>
    </form>
  </div>
</div>


  <script>
    document.getElementById('balance_btn').addEventListener('click', function() {
      document.getElementById('popupWrapper_company').style.display = 'flex';
    });

   // Функция для получения параметров из URL
  function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
  }

  // Проверяем параметр "action"
  const action = getQueryParam('action');
  if (action === 'openPopup_company') {
    // Автоматически выполняем логику при переходе
    const popup = document.getElementById('popupWrapper_company');
    if (popup) {
      popup.style.display = 'flex'; // Открываем попап
    }
  }

// Закрытие попапа при клике на затемненный фон (popup__wrapper)
document.getElementById('popupWrapper_company').addEventListener('click', function(event) {
    // Проверяем, был ли клик именно на фон (класс popup__wrapper)
    if (event.target === document.getElementById('popupWrapper_company')) {
        document.getElementById('popupWrapper_company').style.display = 'none';
    }
});
  </script>


<script>
  document.addEventListener("DOMContentLoaded", () => {
    const select = document.querySelector("#gender");
    const customSelect = select.closest(".custom-select");

    let isOpen = false;

    // Функция для закрытия селекта и возврата стрелки вправо
    const closeSelect = () => {
      customSelect.classList.remove("active");
      isOpen = false;
    };

    // При клике на select — активируем стрелку
    select.addEventListener("mousedown", () => {
      if (!isOpen) {
        customSelect.classList.add("active");
        isOpen = true;
      }
      // НЕ используем e.preventDefault(), чтобы разрешить стандартное поведение браузера
    });

    // Когда селект теряет фокус — закрываем и возвращаем стрелку вправо
    select.addEventListener("blur", () => {
      setTimeout(() => {
        if (isOpen) {
          closeSelect();
        }
      }, 0); // Используем setTimeout для корректного управления фокусом
    });

    // При выборе значения — закрываем и возвращаем стрелку вправо
    select.addEventListener("change", () => {
      closeSelect();
    });

    // Клик вне селекта — закрываем, если открыт
    document.addEventListener("click", (e) => {
      if (!e.target.closest(".custom-select") && isOpen) {
        closeSelect();
      }
    });
  });
</script>








               <style>

.form__person-span {
  display: block;
  font-size: 16px;
  font-weight: bold;
  margin-bottom: 8px;
  color: #333;
}

.custom-select {
  position: relative;
  width: 100%;
}

/* Стили для select */
.form__select {
  width: 100%;
  padding: 12px 15px;
  font-size: 16px;
  font-family: 'Arial', sans-serif;
  color: #333;
  border: 1px solid #ccc;
  border-radius: 5px;
  background-color: #f9f9f9;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  cursor: pointer;
}

/* Убираем синий фокус */
.form__select:focus {
  outline: none;
  border-color: #ccc;
}

/* Стили стрелки */
.arrow {
  position: absolute;
  top: 50%;
  right: 15px;
  transform: translateY(-50%) rotate(0deg); /* ВПРАВО (→) */
  transition: transform 0.3s ease;
  pointer-events: none;
}

.custom-select.active .arrow {
  transform: translateY(-50%) rotate(90deg); /* ВНИЗ (↓) */
}



/* Стили для option */
.form__option {
  padding: 10px;
  font-size: 16px;
  background-color: #fff;
  color: #333;
}

/* При наведении */
.form__option:hover {
  background-color: #f0f0f0;
}




                   .form__person-span {
  text-align: left; /* Выравнивание по левому краю */
  display: block; /* Для того, чтобы метки располагались на новой строке */
}
  /* Общая обертка попапа */
  .popup__wrapper {margin-top: -60px;
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    justify-content: center;
    align-items: center;
    z-index: 998;
    transition: opacity 0.4s ease;
    opacity: 0;
  }

  .popup__wrapper.active {
    display: flex;
    opacity: 1;
  }
  /* Общая обертка попапа */
  .popup__wrapper_w {margin-top: -30px; padding: 2px;
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    justify-content: center;
    align-items: center;
    z-index: 998;
    transition: opacity 0.4s ease;
    opacity: 0;
  }

  .popup__wrapper_w.active {
    display: flex;
    opacity: 1;
  }

  /* Сам попап */
  .popup {
    background: #fff;
    max-width: 600px;
    width: 100%;
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    position: relative;
  }

  .form {
    width: 100%;
  }

  .form__title {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 30px;
    text-align: center;
  }

  .form__item {
    margin-bottom: 20px;
  }

  .form__label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #333;
  }

  .form__input,
  .form__select,
  .form__textarea {
    width: 100%;
    border: 1px solid #ccc;
    border-radius: 12px;
    padding: 14px;
    font-size: 16px;
    box-sizing: border-box;
    background: #f9f9f9;
  }

  .form__textarea {
    resize: vertical;
    min-height: 100px;
  }

  .form__span {
    font-size: 12px;
    color: #777;
    margin-top: 5px;
    display: block;
  }

  .form__checkbox-box {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    align-items: flex-start;
  }

  .form__checkbox {
    margin-top: 4px;
  }

  .form__checkbox-label {
    font-size: 14px;
    color: #444;
  }

  .form__input-file {
    display: none;
  }

  .form__input-file__label {
    display: block;
    padding: 14px;
    border: 2px dashed #ccc;
    border-radius: 12px;
    background: #f9f9f9;
    text-align: center;
    cursor: pointer;
    font-size: 15px;
  }

  .form__button {
    display: block;
    width: 100%;
    background: #5d5fef;
    color: white;
    font-size: 16px;
    padding: 14px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    margin-top: 30px;
    transition: background 0.3s;
  }

  .form__button:hover {
    background: #494cf0;
  }
</style>


<script>
  document.addEventListener('DOMContentLoaded', () => {
    const popupWrapper = document.getElementById('popupWrapper_company');
    const popup = popupWrapper.querySelector('.popup');

    // Открытие попапа
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('btn')) {
        popupWrapper.classList.add('active');
      }
    });

    // Закрытие попапа при клике вне области
    popupWrapper.addEventListener('click', (e) => {
      if (!popup.contains(e.target)) {
        popupWrapper.classList.remove('active');
      }
    });
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const popupWrapper = document.getElementById('popupWrapper_person_x');
    const popup = popupWrapper.querySelector('.popup');

    // Открытие попапа
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('btn-ai')) {
        popupWrapper.classList.add('active');
      }
    });

    // Закрытие попапа при клике вне области
    popupWrapper.addEventListener('click', (e) => {
      // Закрываем только если кликнули по самому фону (а не по popup)
      if (!popup.contains(e.target)) {
        popupWrapper.classList.remove('active');
      }
    });
  });
</script>

<!-- Стиль для модального окна -->
<style>
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background-color: white;
    padding: 20px;
    position: relative;
  }

  #imageToCrop {
    max-width: 100%;
  }

  #timer {
    margin-top: 20px;
    font-size: 20px;
    color: red;
  }

  #croppedImageContainer img {
    display: block;
    margin: 20px auto;
    max-width: 80%;
    max-height: 80%;
    object-fit: contain;
  }
</style>

<script>
  let cropper;
  const modal = document.getElementById('cropperModal');
  const imageToCrop = document.getElementById('imageToCrop');
  const fileLabel = document.getElementById('fileLabel');
  const croppedImageContainer = document.getElementById('croppedImageContainer');
  const closeBtn = document.getElementById('closeCropperModal'); // Кнопка "Готово"
  const cancelBtn = document.getElementById('cancelCropperModal');
    const changeImageText = document.getElementById('changeImageText');
  function updateFileName() {
    const input = document.getElementById('agentInput');

    if (input.files && input.files[0]) {
      fileLabel.textContent = input.files[0].name;
      const file = input.files[0];
      const reader = new FileReader();

      reader.onload = function (e) {
        imageToCrop.src = e.target.result;
        modal.style.display = 'flex';

        if (cropper) {
          cropper.destroy();
        }

        cropper = new Cropper(imageToCrop, {
          aspectRatio: 1,
          viewMode: 1
        });
      };

      reader.readAsDataURL(file);
    }
  }

  // Закрытие по кнопке
  closeBtn.addEventListener('click', function () {
    if (cropper) {
      const croppedCanvas = cropper.getCroppedCanvas();
      const croppedImageUrl = croppedCanvas.toDataURL('image/jpeg');

      const img = document.createElement('img');
      img.src = croppedImageUrl;
      croppedImageContainer.innerHTML = '';
      croppedImageContainer.appendChild(img);

      modal.style.display = 'none';
      cropper.destroy();
      cropper = null;

      changeImageText.style.display = 'block';
    }
  });

     // Отмена выбора изображения
  cancelBtn.addEventListener('click', function () {
    // Скрываем модальное окно
    modal.style.display = 'none';

    // Очищаем выбранный файл
    const input = document.getElementById('agentInput');
    input.value = '';  // Сбросить выбранный файл

    // Сбросить имя файла и скрыть текст
    fileLabel.textContent = 'Выберите фотографию HR-агента';
    changeImageText.style.display = 'none';

    // Очищаем контейнер с обрезанным изображением
    croppedImageContainer.innerHTML = '';

    // Если был активирован cropper, уничтожаем его
    if (cropper) {
      cropper.destroy();
      cropper = null;
    }
  });
</script>

<!--
<script>
document.getElementById('generate-interview-btn').addEventListener('click', async (event) => {
    event.preventDefault();

    const position = localStorage.getItem("selectedPosition");
    const skills = localStorage.getItem("selectedSkills");
    const gender = "ЖЕН";

    if (!position || !skills) {
        alert("Сначала выберите вакансию, нажав на 'Интервью с AI'");
        return;
    }

    const formData = new URLSearchParams();
    formData.append("position", position);
    formData.append("skills", skills);
    formData.append("gender", gender);

    console.log("Генерация начинается...");

    const response = await fetch('http://127.0.0.1:8122/generate_interview/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: formData.toString()
    });
    console.log("Генерация успешно завершена!");
    const result = await response.json();
    console.log("Полный JSON-ответ:", result);
});
</script>-->


<!--<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Инициализируем Quill
    window.quillEditor = new Quill('#editor', {
      theme: 'snow'
    });

    // Обработка кнопки генерации интервью
    document.getElementById('generate-interview-btn').addEventListener('click', async (event) => {
      event.preventDefault();

      const position = localStorage.getItem("selectedPosition");
      const skills = localStorage.getItem("selectedSkills");
      const gender = document.getElementById("gender").value;

      if (!position || !skills) {
        alert("Сначала выберите вакансию, нажав на 'Интервью с AI'");
        return;
      }

      // Извлекаем до 15 вопросов из редактора
      const editor = window.quillEditor;
      if (!editor) {
        alert("Редактор ещё не загружен.");
        return;
      }

      let rawQuestions = editor.getText().split('\n').map(q => q.trim()).filter(q => q.length > 0);
      rawQuestions = rawQuestions.slice(0, 15); // максимум 15
      const questionsJSON = JSON.stringify(rawQuestions);

    // Обрезка изображения
    const imageElement = document.querySelector('#croppedImageContainer img');
    let base64Photo = "";
    if (imageElement && imageElement.src.startsWith("data:image")) {
      base64Photo = imageElement.src;
    }

      // Сохраняем в localStorage, если надо
      localStorage.setItem("selectedGender", gender);
      localStorage.setItem("selectedQuestions", questionsJSON);
      localStorage.setItem("croppedPhoto", base64Photo);

      // Подготовка формы
      const formData = new URLSearchParams();
      formData.append("position", position);
      formData.append("skills", skills);
      formData.append("gender", gender);
      formData.append("image", base64Photo);
      formData.append("priority_questions", questionsJSON);

      console.log("Генерация начинается...");

      try {
        const response = await fetch('http://127.0.0.1:8122/generate_interview/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: formData.toString()
        });

        console.log("Генерация успешно завершена!");
        const result = await response.json();
        console.log("Полный JSON-ответ:", result);
        //alert("Интервью сгенерировано. Смотрите консоль.");
      } catch (error) {
        console.error("Ошибка при генерации:", error);
        alert("Произошла ошибка при генерации интервью.");
      }
    });
  });
</script>-->



<!--<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Настраиваем панель инструментов только с кнопкой нумерованного списка
    var toolbarOptions = [
      ['list'], // Только кнопка для списков
      [{ 'list': 'ordered' }] // Конкретно нумерованный список
    ];

    // Инициализируем Quill редактор
    window.quillEditor = new Quill('#editor', {
      modules: {
        toolbar: toolbarOptions
      },
      placeholder: 'Введите список приоритетных вопросов для включения в интервью',
      theme: 'snow'
    });

    // Программно активируем нумерованный список сразу при загрузке редактора
    window.quillEditor.format('list', 'ordered');

    // Функция для добавления элемента списка по умолчанию при начале ввода
    window.quillEditor.on('text-change', function (delta, oldDelta, source) {
      // Если редактор пуст, начинаем с нумерованного списка
      if (window.quillEditor.getText().trim() === '') {
        window.quillEditor.formatLine(0, 0, 'list', 'ordered');
      }
    });

    // Обработка кнопки генерации интервью
    document.getElementById('generate-interview-btn').addEventListener('click', async (event) => {
      event.preventDefault();

      const position = localStorage.getItem("selectedPosition");
      const skills = localStorage.getItem("selectedSkills");
      const gender = document.getElementById("gender").value;

      if (!position || !skills) {
        alert("Сначала выберите вакансию, нажав на 'Интервью с AI'");
        return;
      }

      // Извлекаем до 15 вопросов из редактора
      const editor = window.quillEditor;
      if (!editor) {
        alert("Редактор ещё не загружен.");
        return;
      }

      let rawQuestions = editor.getText().split('\n').map(q => q.trim()).filter(q => q.length > 0);
      rawQuestions = rawQuestions.slice(0, 15); // максимум 15
      const questionsJSON = JSON.stringify({ questions: rawQuestions });

      // Обрезка изображения
      const imageElement = document.querySelector('#croppedImageContainer img');
      let base64Photo = "";
      if (imageElement && imageElement.src.startsWith("data:image")) {
        base64Photo = imageElement.src;
      }

      // Сохраняем в localStorage, если надо
      localStorage.setItem("selectedGender", gender);
      localStorage.setItem("selectedQuestions", questionsJSON);
      localStorage.setItem("croppedPhoto", base64Photo);

      // Подготовка формы
      const formData = new URLSearchParams();
      formData.append("position", position);
      formData.append("skills", skills);
      formData.append("gender", gender);
      formData.append("image", base64Photo);
      formData.append("priority_questions", questionsJSON);

      console.log("Генерация начинается...");

      try {
        const response = await fetch('http://127.0.0.1:8122/generate_interview/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: formData.toString()
        });

        console.log("Генерация успешно завершена!");
        const result = await response.json();
        console.log("Полный JSON-ответ:", result);
        //alert("Интервью сгенерировано. Смотрите консоль.");
      } catch (error) {
        console.error("Ошибка при генерации:", error);
        alert("Произошла ошибка при генерации интервью.");
      }
    });
  });

  // Инициализируем Quill редактор
    window.quillEditor = new Quill('#editor', {
      modules: {
        toolbar: toolbarOptions
      },
      placeholder: 'Введите список приоритетных вопросов для включения в интервью',
      theme: 'snow'
    });
</script>-->
<div id="editor" style="height: 200px; display: none;"></div>
<style>/* Стиль после нажатия для кнопок .btn-ai */
.btn-ai.clicked {
  background-color: transparent;
  color: var(--c-gray);
  border: 1px solid var(--c-gray);
  cursor: default !important;
}</style>
<!--<script>
  document.addEventListener('DOMContentLoaded', function () {


  // Получаем данные из шаблона
  const existingInterviewsRaw = JSON.parse('{{ existing_interviews_json|safe }}');
  console.log('Существующие интервью (сырые данные):', existingInterviewsRaw);

  // Преобразуем в массив объектов для удобства
  const existingInterviews = existingInterviewsRaw.map(([applicantId, vacancyId]) => ({
    applicantId: Number(applicantId),
    vacancyId: Number(vacancyId)
  }));
  console.log('Существующие интервью (обработанные):', existingInterviews);

  const interviewButtons = document.querySelectorAll('.btn-ai');

  interviewButtons.forEach(button => {
    const applicantId = button.getAttribute('data-applicant-id');
    const vacancyId = button.getAttribute('data-vacancy-id'); // Добавьте этот атрибут в HTML

    if (!applicantId || !vacancyId) {
      console.warn('Отсутствует data-applicant-id или data-vacancy-id:', button);
      return;
    }

    const applicantIdNumber = Number(applicantId);
    const vacancyIdNumber = Number(vacancyId);

    if (isNaN(applicantIdNumber) || isNaN(vacancyIdNumber)) {
      console.error('Некорректные data-applicant-id или data-vacancy-id:', applicantId, vacancyId);
      return;
    }

    const alreadyExists = existingInterviews.some(
      interview => interview.applicantId === applicantIdNumber && interview.vacancyId === vacancyIdNumber
    );
    console.log(`Соискатель ID ${applicantIdNumber}, Вакансия ID ${vacancyIdNumber}: Найдено интервью -`, alreadyExists);

if (alreadyExists) {
    button.textContent = 'Приглашение отправлено';
    button.classList.add('clicked'); // Применяем стиль через CSS
    button.style.pointerEvents = 'none'; // Отключаем взаимодействие
  }
  });



    // Обработка кнопки генерации интервью
document.getElementById('generate-interview-btn').addEventListener('click', async (event) => {
  event.preventDefault();

  // Проверяем, что данные для генерации существуют
  if (!lastClickedInterviewButton || !lastClickedInterviewButton.generateData) {
    alert("Сначала выберите вакансию, нажав на 'Интервью с AI'");
    return;
  }

  // --- ЗАКРЫТИЕ ПОПАПА ПЕРЕД НАЧАЛОМ ГЕНЕРАЦИИ ---
  const popupWrapper = document.getElementById('popupWrapper_person_x'); // Находим попап по ID
if (popupWrapper && popupWrapper.classList.contains('active')) {
  popupWrapper.classList.remove('active'); // Убираем класс active
}

  const { vacancyTitle, vacancySkills, vacancyCompany, applicantName, applicantLastName, applicantRole } = lastClickedInterviewButton.generateData;

  // Меняем текст и стиль кнопки
  lastClickedInterviewButton.style.pointerEvents = 'none';
  lastClickedInterviewButton.textContent = 'Идёт генерация...';
  lastClickedInterviewButton.style.color = '#007bff';
  lastClickedInterviewButton.style.border = '2px solid #007bff';
  lastClickedInterviewButton.style.backgroundColor = '#ffffff';
  lastClickedInterviewButton.style.cursor = 'default';

  // Показываем предупреждение
  const warningBlock = document.getElementById('generation-warning');
  if (warningBlock) {
    warningBlock.style.display = 'block';
  }
  // Начинаем обновлять прогресс-бар
  startProgressBar();
  try {




    // Обрезка изображения
    const imageElement = document.querySelector('#croppedImageContainer img');
    let base64Photo = "";
    if (imageElement && imageElement.src.startsWith("data:image")) {
      base64Photo = imageElement.src;
    }

    // Подготовка формы
    const formData = new URLSearchParams();
    formData.append("position", vacancyTitle);
    formData.append("skills", vacancySkills);
    formData.append("gender", document.getElementById("gender").value);
    formData.append("image", base64Photo);


    console.log("Генерация начинается...");

    // Отправляем запрос на сервер
    const response = await fetch('http://127.0.0.1:8122/generate_interview/', {
    // const response = await fetch('https://officially-aboveboard-rockfish.cloudpub.ru/generate_interview/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: formData.toString()
    });

    console.log("Генерация успешно завершена!");
    const result = await response.json();
    console.log("Полный JSON-ответ:", result);

    // После успешной генерации интервью вызываем createInterview
    await createInterview({
      vacancyTitle,
      vacancySkills,
      vacancyCompany,
      applicantName,
      applicantLastName,
      applicantRole,
      gender: document.getElementById("gender").value,
      agentName: document.getElementById("agentName").value,
      interview_result: result
    });
  } catch (error) {
    console.error("Ошибка при генерации:", error);
    alert("Произошла ошибка при генерации интервью.");
  } finally {
    // Сбрасываем состояние кнопки
    if (lastClickedInterviewButton) {
      // lastClickedInterviewButton.textContent = 'Генерация завершена';
      // lastClickedInterviewButton.style.color = '#007bff';
      // lastClickedInterviewButton.style.border = '2px solid #007bff';
      // lastClickedInterviewButton.style.backgroundColor = '#ffffff';
      // lastClickedInterviewButton.style.cursor = 'default';
    }

    // Убираем предупреждение
    const warningBlock = document.getElementById('generation-warning');
    if (warningBlock) {
      warningBlock.style.display = 'none';
    }
    location.reload();
  }
});

// Получение CSRF-токена из cookies
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let cookie of cookies) {
      cookie = cookie.trim();
      if (cookie.startsWith(name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

// Функция для создания интервью
async function createInterview(data) {
  const {
    vacancyTitle,
    vacancySkills,
    vacancyCompany,
    applicantName,
    applicantLastName,
    applicantRole,
    gender,
    agentName,
    interview_result
  } = data;

  // Проверяем, что все данные существуют
  if (!vacancyTitle || !vacancySkills || !vacancyCompany || !applicantName || !applicantLastName || !applicantRole) {
    console.error("Не все необходимые данные доступны.");
    return;
  }

  // Подготовка данных для отправки
  const formData = {
    vacancy_title: vacancyTitle,
    vacancy_skills: vacancySkills,
    vacancy_company: vacancyCompany,
    applicant_name: applicantName,
    applicant_last_name: applicantLastName,
    applicant_role: applicantRole,
    gender: gender,
    agent_name: agentName,
    interview_result: interview_result
  };

  // Получаем CSRF-токен
  const csrftoken = getCookie('csrftoken');
  if (!csrftoken) {
    console.error("CSRF токен не найден.");
    return;
  }

  try {
    const response = await fetch('/create_interview/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrftoken
      },
      body: JSON.stringify(formData),
      credentials: 'same-origin'
    });

    if (response.ok) {
      const responseData = await response.json();
      console.log("Интервью успешно создано:", responseData);
    } else {
      console.error("Ошибка при создании интервью:", response.statusText);
    }
  } catch (error) {
    console.error("Ошибка сети:", error);
  }
}



  });


</script>-->


<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Глобальная переменная для хранения последней нажатой кнопки
    let lastClickedInterviewButton = null;

    // Получаем данные из шаблона
    const existingInterviewsRaw = JSON.parse('{{ existing_interviews_json|safe }}');
    console.log('Существующие интервью (сырые данные):', existingInterviewsRaw);

    // Преобразуем в массив объектов для удобства
    const existingInterviews = existingInterviewsRaw.map(([applicantId, vacancyId]) => ({
      applicantId: Number(applicantId),
      vacancyId: Number(vacancyId)
    }));
    console.log('Существующие интервью (обработанные):', existingInterviews);

    const interviewButtons = document.querySelectorAll('.btn-ai');

    interviewButtons.forEach(button => {
      const applicantId = button.getAttribute('data-applicant-id');
      const vacancyId = button.getAttribute('data-vacancy-id'); // Добавьте этот атрибут в HTML

      if (!applicantId || !vacancyId) {
        console.warn('Отсутствует data-applicant-id или data-vacancy-id:', button);
        return;
      }

      const applicantIdNumber = Number(applicantId);
      const vacancyIdNumber = Number(vacancyId);

      if (isNaN(applicantIdNumber) || isNaN(vacancyIdNumber)) {
        console.error('Некорректные data-applicant-id или data-vacancy-id:', applicantId, vacancyId);
        return;
      }

      const alreadyExists = existingInterviews.some(
        interview => interview.applicantId === applicantIdNumber && interview.vacancyId === vacancyIdNumber
      );
      console.log(`Соискатель ID ${applicantIdNumber}, Вакансия ID ${vacancyIdNumber}: Найдено интервью -`, alreadyExists);

      if (alreadyExists) {
        button.textContent = 'Приглашение отправлено';
        button.classList.add('clicked');
        button.style.pointerEvents = 'none';
      }
    });

    // Обработчик клика по кнопке ".btn-ai"
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('btn-ai')) {
        const popupWrapper = document.getElementById('popupWrapper_person_x');
        popupWrapper.classList.add('active');

        lastClickedInterviewButton = e.target;

        // Создаём generateData, если его нет
        if (!lastClickedInterviewButton.generateData) {
          lastClickedInterviewButton.generateData = {};
        }

        // Сохраняем текущее состояние формы в generateData этой кнопки
        lastClickedInterviewButton.generateData.gender = document.getElementById("gender").value;
        lastClickedInterviewButton.generateData.agentName = document.getElementById("agentName").value;

        // Подставляем ранее введённые значения для этого кандидата
        document.getElementById("gender").value = lastClickedInterviewButton.generateData.gender || '';
        document.getElementById("agentName").value = lastClickedInterviewButton.generateData.agentName || '';
      }
    });

    // Закрытие попапа — очищаем форму
    document.getElementById('popupWrapper_person_x').addEventListener('click', function(e) {
      const popup = this.querySelector('.popup');
      if (!popup.contains(e.target)) {
        document.getElementById("gender").value = "";
        document.getElementById("agentName").value = "";
        document.querySelector('#croppedImageContainer').innerHTML = '';
        this.classList.remove('active');
      }
    });

    // Обработка кнопки "Сгенерировать интервью"
    document.getElementById('generate-interview-btn').addEventListener('click', async function(event) {
      event.preventDefault();

      if (!lastClickedInterviewButton || !lastClickedInterviewButton.generateData) {
        alert("Сначала выберите вакансию, нажав на 'Интервью с AI'");
        return;
      }

      // --- ЗАКРЫТИЕ ПОПАПА ПЕРЕД НАЧАЛОМ ГЕНЕРАЦИИ ---
      const popupWrapper = document.getElementById('popupWrapper_person_x');
      if (popupWrapper && popupWrapper.classList.contains('active')) {
        popupWrapper.classList.remove('active');
      }

      const { vacancyTitle, vacancySkills, vacancyCompany, applicantName, applicantLastName, applicantRole } = lastClickedInterviewButton.generateData;

      // Меняем текст и стиль кнопки
      lastClickedInterviewButton.style.pointerEvents = 'none';
      lastClickedInterviewButton.textContent = 'Идёт генерация...';
      lastClickedInterviewButton.style.color = '#007bff';
      lastClickedInterviewButton.style.border = '2px solid #007bff';
      lastClickedInterviewButton.style.backgroundColor = '#ffffff';
      lastClickedInterviewButton.style.cursor = 'default';

      // Получаем актуальные значения из формы
      const gender = document.getElementById("gender").value || "ЖЕН";
      const agentName = document.getElementById("agentName").value;

      // Сохраняем их в generateData текущей кнопки
      lastClickedInterviewButton.generateData.gender = gender;
      lastClickedInterviewButton.generateData.agentName = agentName;

      // Показываем предупреждение
      const warningBlock = document.getElementById('generation-warning');
      if (warningBlock) {
        warningBlock.style.display = 'block';
      }

      // Начинаем обновлять прогресс-бар
      startProgressBar();

      try {
        // Обрезка изображения
        const imageElement = document.querySelector('#croppedImageContainer img');
        let base64Photo = "";
        if (imageElement && imageElement.src.startsWith("data:image")) {
          base64Photo = imageElement.src;
        }

        // Подготовка формы
        const formData = new URLSearchParams();
        formData.append("position", vacancyTitle);
        formData.append("skills", vacancySkills);
        formData.append("gender", gender);
        formData.append("image", base64Photo);

        console.log("Генерация начинается...");

        // Отправляем запрос на сервер
        const response = await fetch('http://127.0.0.1:8122/generate_interview/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: formData.toString()
        });

        console.log("Генерация успешно завершена!");
        const result = await response.json();
        console.log("Полный JSON-ответ:", result);

        // После успешной генерации интервью вызываем createInterview
        await createInterview({
          vacancyTitle,
          vacancySkills,
          vacancyCompany,
          applicantName,
          applicantLastName,
          applicantRole,
          gender,
          agentName,
          interview_result: result
        });
      } catch (error) {
        console.error("Ошибка при генерации:", error);
        alert("Произошла ошибка при генерации интервью.");
      } finally {
        // Сбрасываем состояние кнопки
        if (lastClickedInterviewButton) {
          lastClickedInterviewButton.textContent = 'Интервью создано';
          lastClickedInterviewButton.classList.add('clicked');
        }

        // Убираем предупреждение
        const warningBlock = document.getElementById('generation-warning');
        if (warningBlock) {
          warningBlock.style.display = 'none';
        }

        location.reload();
      }
    });

    // Получение CSRF-токена из cookies
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
          cookie = cookie.trim();
          if (cookie.startsWith(name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    // Функция для создания интервью
    async function createInterview(data) {
      const {
        vacancyTitle,
        vacancySkills,
        vacancyCompany,
        applicantName,
        applicantLastName,
        applicantRole,
        gender,
        agentName,
        interview_result
      } = data;

      // Проверяем, что все данные существуют
      if (!vacancyTitle || !vacancySkills || !vacancyCompany || !applicantName || !applicantLastName || !applicantRole) {
        console.error("Не все необходимые данные доступны.");
        return;
      }

      // Подготовка данных для отправки
      const formData = {
        vacancy_title: vacancyTitle,
        vacancy_skills: vacancySkills,
        vacancy_company: vacancyCompany,
        applicant_name: applicantName,
        applicant_last_name: applicantLastName,
        applicant_role: applicantRole,
        gender: gender,
        agent_name: agentName,
        interview_result: interview_result
      };

      // Получаем CSRF-токен
      const csrftoken = getCookie('csrftoken');
      if (!csrftoken) {
        console.error("CSRF токен не найден.");
        return;
      }

      try {
        const response = await fetch('/create_interview/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken
          },
          body: JSON.stringify(formData),
          credentials: 'same-origin'
        });

        if (response.ok) {
          const responseData = await response.json();
          console.log("Интервью успешно создано:", responseData);
        } else {
          console.error("Ошибка при создании интервью:", response.statusText);
        }
      } catch (error) {
        console.error("Ошибка сети:", error);
      }
    }

// Переменные для прогресс-бара
let currentProgress = 0;
let totalTime = 105;  // Изначальное время для одной генерации (1 минута 15 секунд = 75 секунд)
let intervalId;
let timeElapsed = 0; // Время, прошедшее с начала генерации
let isGenerating = false; // Флаг для отслеживания состояния генерации

// Функция для склонения слов в зависимости от числа
function getMinuteText(minutes) {
  if (minutes === 1) {
    return `${minutes} минута`;
  } else if (minutes > 1 && minutes < 5) {
    return `${minutes} минуты`;
  } else {
    return `${minutes} минут`;
  }
}

function getSecondText(seconds) {
  if (seconds === 1) {
    return `${seconds} секунда`;
  } else if (seconds > 1 && seconds < 5) {
    return `${seconds} секунды`;
  } else {
    return `${seconds} секунд`;
  }
}

// Функция для форматирования времени в минуты и секунды
function formatTime(seconds) {
  const minutes = Math.floor(seconds / 60);
  const remainingSeconds = seconds % 60;

    // Если минуты равны 0, то показываем только секунды
  if (minutes === 0) {
    return `${getSecondText(remainingSeconds)}`;
  }

  return `${getMinuteText(minutes)} ${getSecondText(remainingSeconds)}`;
}

// Функция для запуска прогресс-бара
function startProgressBar() {
  if (isGenerating) {
    // Если уже идет генерация, увеличиваем общее время на 75 секунд
    totalTime += 105;
    return; // Не начинаем новую генерацию, если она уже идет
  }

  isGenerating = true;
  timeElapsed = 0;  // Сброс времени при начале новой генерации
  currentProgress = 0; // Сброс прогресса

  const progressBar = document.getElementById('progress-bar');
  const progressContainer = document.getElementById('progress-bar-container');
  const progressText = document.getElementById('progress-text');

  if (!progressBar || !progressContainer) {
    console.error('Прогресс-бар или контейнер не найден!');
    return;
  }

  progressContainer.style.display = 'block';  // Показываем прогресс-бар
  // progressText.innerText = `Ожидайте, генерация займет примерно ${formatTime(totalTime)}`;

  // Функция для обновления прогресса
  intervalId = setInterval(() => {
    if (timeElapsed < totalTime) {
      timeElapsed++;
      currentProgress = (timeElapsed / totalTime) * 100;
      progressBar.style.width = currentProgress + '%';
      // progressText.innerText = `Ожидайте, генерация займет примерно: ${formatTime(totalTime - timeElapsed)}`;

    } else {
      clearInterval(intervalId);  // Завершаем процесс, когда время прошло
      // progressText.innerText = 'Генерация завершена';
      isGenerating = false; // Генерация завершена
    }
  }, 1000);  // Обновляем каждую секунду
}

  });
</script>



<footer>
    &copy; 2024 IT-WorkRu. Все права защищены.
</footer>

</body>
</html>